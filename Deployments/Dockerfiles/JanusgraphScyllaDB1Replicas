services:
  scylla1:
    container_name: scylla1
    image: scylladb/scylla:2025.3
    restart: always
    command: --seeds=scylla1 --smp 1 --memory 1G --overprovisioned 1 --api-address 0.0.0.0 --reactor-backend=epoll
    healthcheck:
      test: ["CMD-SHELL", "nodetool status | grep UN"]
      interval: 10s
      timeout: 5s
      retries: 10


  janusgraph:
    image: janusgraph/janusgraph:latest
    container_name: janusgraph
    environment:
      # JANUS_PROPS_TEMPLATE: cql
      janusgraph.storage.backend: cql
      janusgraph.storage.hostname: scylla1
      janusgraph.storage.cql.keyspace: janusgraph
      janusgraph.storage.lock.retries: 10
      janusgraph.storage.lock.wait-time: 20000
      janusgraph.graph.set-vertex-id: true
      janusgraph.graph.set-edge-id: true
      janusgraph.graph.allow-custom-vid-types: true
      janusgraph.graph.allow-custom-eid-types: true
      janusgraph.storage.batch-loading: true
    volumes:
      - ../../PreloadData:/var/lib/janusgraph/import

    depends_on:
      scylla1:
        condition : service_healthy

    healthcheck:
      test: ["CMD-SHELL", "timeout 5 bash -c '</dev/tcp/localhost/8182' || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10
    ports:
      - "8182:8182"